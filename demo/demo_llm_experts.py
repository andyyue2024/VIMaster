"""
LLM ä¸“å®¶ Agent æ¼”ç¤ºè„šæœ¬

æœ¬è„šæœ¬å±•ç¤ºå¦‚ä½•ä½¿ç”¨åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åˆ†æä¸“å®¶ Agentã€‚

ä¸“å®¶ Agent åˆ—è¡¨ï¼š
1. Fundamentals Agent - åŸºæœ¬é¢åˆ†æï¼ˆç›ˆåˆ©ã€å¢é•¿ã€è´¢åŠ¡å¥åº·ã€ä¼°å€¼æ¯”ç‡ï¼‰
2. Sentiment Agent    - å¸‚åœºæƒ…ç»ªåˆ†æï¼ˆå†…éƒ¨äº¤æ˜“ã€æ–°é—»æƒ…ç»ªï¼‰
3. Valuation Expert Agent - ä¼°å€¼ä¸“å®¶ï¼ˆDCFã€æ‰€æœ‰è€…æ”¶ç›Šä¼°å€¼ï¼‰
4. Technical Agent    - æŠ€æœ¯åˆ†æï¼ˆè¶‹åŠ¿ã€åŠ¨é‡ã€å‡å€¼å›å½’ã€æ³¢åŠ¨ç‡ï¼‰
5. Risk Manager Agent - é£é™©ç®¡ç†ï¼ˆå¤´å¯¸é™åˆ¶ã€é£é™©æŒ‡æ ‡ï¼‰
6. Portfolio Manager Agent - æŠ•èµ„ç»„åˆç»ç†ï¼ˆç»¼åˆå†³ç­–ã€è®¢å•ç”Ÿæˆï¼‰
"""
import os
import sys

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from src.agents.llm import (
    LLMConfigManager,
    FundamentalsAgent,
    SentimentAgent,
    ValuationExpertAgent,
    TechnicalAgent,
    RiskManagerAgent,
    PortfolioManagerAgent,
    get_all_expert_agents,
    get_expert_agent_by_name,
)
from src.agents.llm.expert_agents import run_all_experts_analysis, get_expert_consensus
from src.schedulers.workflow_scheduler import AnalysisManager


def print_separator():
    print("\n" + "="*80 + "\n")


def demo_list_experts():
    """å±•ç¤ºæ‰€æœ‰å¯ç”¨çš„ä¸“å®¶ Agent"""
    print("ğŸ“‹ å¯ç”¨çš„ LLM åˆ†æä¸“å®¶ Agent")
    print_separator()

    agents = get_all_expert_agents()
    for i, agent in enumerate(agents, 1):
        print(f"{i}. {agent.name}")
        print(f"   æè¿°: {agent.description}")
        print(f"   æç¤ºè¯æ–‡ä»¶: {agent.master_file}")
        print()


def demo_expert_workflow():
    """å±•ç¤ºä¸“å®¶åˆ†æå·¥ä½œæµ"""
    print("ğŸ”„ ä¸“å®¶åˆ†æå·¥ä½œæµ")
    print_separator()

    print("""
ä¸“å®¶åˆ†æé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼š

1. æ•°æ®å±‚ä¸“å®¶ï¼š
   â”œâ”€â”€ Fundamentals Agent  - åˆ†æè´¢åŠ¡åŸºæœ¬é¢
   â”œâ”€â”€ Sentiment Agent     - åˆ†æå¸‚åœºæƒ…ç»ª
   â””â”€â”€ Technical Agent     - åˆ†ææŠ€æœ¯æŒ‡æ ‡

2. ä¼°å€¼å±‚ä¸“å®¶ï¼š
   â””â”€â”€ Valuation Expert Agent - DCF/æ‰€æœ‰è€…æ”¶ç›Šä¼°å€¼

3. é£é™©å±‚ä¸“å®¶ï¼š
   â””â”€â”€ Risk Manager Agent  - é£é™©æŒ‡æ ‡å’Œå¤´å¯¸é™åˆ¶

4. å†³ç­–å±‚ä¸“å®¶ï¼š
   â””â”€â”€ Portfolio Manager Agent - ç»¼åˆæ‰€æœ‰ä¿¡å·åšå‡ºæœ€ç»ˆå†³ç­–

å·¥ä½œæµç¨‹ï¼š
  æ•°æ®å±‚ â†’ ä¼°å€¼å±‚ â†’ é£é™©å±‚ â†’ å†³ç­–å±‚
""")


def demo_single_expert(stock_code: str = "600519"):
    """å±•ç¤ºä½¿ç”¨å•ä¸ªä¸“å®¶åˆ†æ"""
    print(f"ğŸ‘¤ ä½¿ç”¨å•ä¸ªä¸“å®¶ Agent åˆ†æè‚¡ç¥¨ {stock_code}")
    print_separator()

    # è·å–åŸºç¡€åˆ†ææ•°æ®
    manager = AnalysisManager()
    context = manager.analyze_single_stock(stock_code)

    if not context:
        print(f"âš ï¸ æ— æ³•è·å–è‚¡ç¥¨ {stock_code} çš„æ•°æ®")
        return

    # å±•ç¤ºå„ä¸“å®¶
    print("å¯ç”¨ä¸“å®¶åŠå…¶åˆ†æé¢†åŸŸï¼š\n")

    experts = [
        ("fundamentals", "ç›ˆåˆ©èƒ½åŠ›ã€å¢é•¿æƒ…å†µã€è´¢åŠ¡å¥åº·ã€ä¼°å€¼æ¯”ç‡"),
        ("sentiment", "å†…éƒ¨äº¤æ˜“ä¿¡å·ã€æ–°é—»æƒ…ç»ªåˆ†æ"),
        ("valuation", "DCFä¼°å€¼ã€æ‰€æœ‰è€…æ”¶ç›Šä¼°å€¼"),
        ("technical", "è¶‹åŠ¿è·Ÿè¸ªã€å‡å€¼å›å½’ã€åŠ¨é‡ã€æ³¢åŠ¨ç‡ã€ç»Ÿè®¡å¥—åˆ©"),
        ("risk", "æŠ•èµ„ç»„åˆä»·å€¼ã€å¤´å¯¸é™åˆ¶ã€é£é™©æ§åˆ¶"),
        ("portfolio", "ç»¼åˆå†³ç­–ã€è®¢å•ç”Ÿæˆã€å¤šç©ºäº¤æ˜“"),
    ]

    for name, desc in experts:
        agent = get_expert_agent_by_name(name)
        print(f"  â€¢ {agent.name}")
        print(f"    åˆ†æé¢†åŸŸ: {desc}")
        print()


def demo_all_experts(stock_code: str = "600519"):
    """å±•ç¤ºä½¿ç”¨æ‰€æœ‰ä¸“å®¶åˆ†æ"""
    print(f"ğŸ‘¥ ä½¿ç”¨æ‰€æœ‰åˆ†æä¸“å®¶åˆ†æè‚¡ç¥¨ {stock_code}")
    print_separator()

    agents = get_all_expert_agents()
    print(f"å°†ä½¿ç”¨ {len(agents)} ä½åˆ†æä¸“å®¶è¿›è¡Œåˆ†æï¼š")
    for agent in agents:
        print(f"  â€¢ {agent.name}")
    print()

    print("ğŸ’¡ è¿è¡Œæ‰€æœ‰ä¸“å®¶åˆ†æçš„å‘½ä»¤ï¼š")
    print(f"   python run.py experts {stock_code}")
    print()

    print("åˆ†æå®Œæˆåå°†ç”Ÿæˆï¼š")
    print("  1. æ¯ä½ä¸“å®¶çš„ç‹¬ç«‹åˆ†ææŠ¥å‘Š")
    print("  2. ä¸“å®¶å…±è¯†ï¼ˆç»¼åˆå„ç»´åº¦åˆ†æï¼‰")
    print("  3. æœ€ç»ˆäº¤æ˜“å†³ç­–å’Œè®¢å•å»ºè®®")
    print()

    print("è¾“å‡ºç¤ºä¾‹ï¼š")
    print("""
ã€FundamentalsAgentã€‘ ğŸŸ¢ BULLISH
  ä¿¡å¿ƒåº¦: 75.0%
  åˆ†æç†ç”±: ç›ˆåˆ©èƒ½åŠ›å¼ºåŠ²ï¼ŒROE=32%è¶…è¿‡15%é˜ˆå€¼...

ã€TechnicalAgentã€‘ ğŸŸ¡ NEUTRAL
  ä¿¡å¿ƒåº¦: 55.0%
  åˆ†æç†ç”±: è¶‹åŠ¿çœ‹æ¶¨ä½†åŠ¨é‡å‡å¼±ï¼Œå»ºè®®è§‚æœ›...

ã€PortfolioManagerAgentã€‘ ğŸŸ¢ BULLISH
  ä¿¡å¿ƒåº¦: 68.0%
  åˆ†æç†ç”±: ç»¼åˆå„ä¸“å®¶æ„è§ï¼Œå»ºè®®ä¹°å…¥...
  å†³ç­–: buy, æ•°é‡: 100è‚¡

ã€ä¸“å®¶å…±è¯†ã€‘
  å…±è¯†ä¿¡å·: BULLISH
  çœ‹æ¶¨: 4 | ä¸­æ€§: 1 | çœ‹è·Œ: 0
  å¹³å‡ä¿¡å¿ƒåº¦: 65.5%
""")


def demo_comparison():
    """å±•ç¤ºå¤§å¸ˆ vs ä¸“å®¶çš„åŒºåˆ«"""
    print("âš–ï¸ æŠ•èµ„å¤§å¸ˆ vs åˆ†æä¸“å®¶ å¯¹æ¯”")
    print_separator()

    print("""
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æŠ•èµ„å¤§å¸ˆ (Masters)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰¹ç‚¹ï¼šæ¨¡æ‹ŸçœŸå®æŠ•èµ„å¤§å¸ˆçš„æŠ•èµ„é£æ ¼å’Œç†å¿µ                           â”‚
â”‚ æ¥æºï¼šmasters ç›®å½•ä¸‹çš„æç¤ºè¯æ–‡ä»¶                                 â”‚
â”‚ ä¾§é‡ï¼šæŠ•èµ„å“²å­¦ã€é•¿æœŸä»·å€¼åˆ¤æ–­                                     â”‚
â”‚ é€‚ç”¨ï¼šæˆ˜ç•¥å±‚é¢çš„æŠ•èµ„å†³ç­–                                         â”‚
â”‚                                                                 â”‚
â”‚ åŒ…å«ï¼šæ ¼é›·å„å§†ã€è´¹é›ªã€èŠ’æ ¼ã€å·´è²ç‰¹ç­‰ 7 ä½å¤§å¸ˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åˆ†æä¸“å®¶ (Experts)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰¹ç‚¹ï¼šä¸“æ³¨ç‰¹å®šåˆ†æé¢†åŸŸçš„ä¸“ä¸šåˆ†æ                                 â”‚
â”‚ æ¥æºï¼šexperts ç›®å½•ä¸‹çš„æç¤ºè¯æ–‡ä»¶                                 â”‚
â”‚ ä¾§é‡ï¼šé‡åŒ–åˆ†æã€æŠ€æœ¯æŒ‡æ ‡ã€é£é™©ç®¡ç†                               â”‚
â”‚ é€‚ç”¨ï¼šæˆ˜æœ¯å±‚é¢çš„äº¤æ˜“å†³ç­–                                         â”‚
â”‚                                                                 â”‚
â”‚ åŒ…å«ï¼šåŸºæœ¬é¢ã€æƒ…ç»ªã€ä¼°å€¼ã€æŠ€æœ¯ã€é£é™©ã€ç»„åˆç®¡ç† 6 ä½ä¸“å®¶           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨èä½¿ç”¨æ–¹å¼ï¼š
  1. å…ˆç”¨"å¤§å¸ˆ"åˆ†æè·å–æŠ•èµ„æ–¹å‘å’Œé•¿æœŸè§‚ç‚¹
  2. å†ç”¨"ä¸“å®¶"åˆ†æè·å–å…·ä½“äº¤æ˜“ç­–ç•¥å’Œé£é™©æ§åˆ¶
  3. ç»¼åˆä¸¤è€…åšå‡ºæœ€ç»ˆå†³ç­–
""")


def main():
    print("ğŸŒŸ VIMaster LLM åˆ†æä¸“å®¶ Agent æ¼”ç¤º")
    print("="*80)
    print()

    # 1. åˆ—å‡ºæ‰€æœ‰ä¸“å®¶ Agent
    demo_list_experts()

    # 2. ä¸“å®¶å·¥ä½œæµ
    demo_expert_workflow()
    print_separator()

    # 3. å•ä¸ªä¸“å®¶åˆ†æç¤ºä¾‹
    demo_single_expert("600519")
    print_separator()

    # 4. æ‰€æœ‰ä¸“å®¶åˆ†æç¤ºä¾‹
    demo_all_experts("600519")
    print_separator()

    # 5. å¤§å¸ˆ vs ä¸“å®¶å¯¹æ¯”
    demo_comparison()

    print("\n" + "="*80)
    print("âœ… æ¼”ç¤ºå®Œæˆï¼")
    print()
    print("ä¸‹ä¸€æ­¥ï¼š")
    print("  1. é…ç½® LLM API å¯†é’¥")
    print("  2. è¿è¡Œ: python run.py experts 600519")
    print("  3. æˆ–ç»„åˆä½¿ç”¨: python run.py masters 600519 && python run.py experts 600519")
    print("="*80)


if __name__ == "__main__":
    main()
